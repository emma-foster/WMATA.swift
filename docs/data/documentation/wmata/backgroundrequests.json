{"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","level":2,"type":"heading","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you are using WMATA within an application or extension, your application can receive responses from WMATA’s API while in the background using a delegate for "},{"type":"reference","isActive":true,"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/Endpoint"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Unfortunately, Combine and Swift’s Concurrency features cannot be used while your application is in the background (yet)."}]},{"anchor":"Example","level":2,"type":"heading","text":"Example"},{"type":"paragraph","inlineContent":[{"type":"text","text":"First, select an "},{"type":"reference","isActive":true,"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/Endpoint"},{"type":"text","text":" you wish to call in the background. In this example we’ll call "},{"type":"reference","isActive":true,"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/Bus\/NextBuses"},{"type":"text","text":", which is a Standard API endpoint. We’ll need to define a subclass of "},{"type":"reference","isActive":true,"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/JSONEndpointDelegate"},{"type":"text","text":" in order to receive responses from the API."}]},{"type":"aside","style":"note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If you are calling a Standard API endpoint, subclass "},{"type":"reference","isActive":true,"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/JSONEndpointDelegate"},{"type":"text","text":". If you are calling a GTFS endpoint, subclass "},{"type":"reference","isActive":true,"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/GTFSEndpointDelegate"},{"type":"text","text":"."}]}]},{"type":"codeListing","syntax":"swift","code":["class CustomEndpointDelegate: JSONEndpointDelegate<Bus.NextBuses> {","    ","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Next, we’ll need to override "},{"type":"reference","isActive":true,"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/EndpointDelegate\/received(_:)"},{"type":"text","text":" within our delegate in order to receive responses."}]},{"type":"codeListing","syntax":"swift","code":["override func received(_ response: Result<Bus.NextBuses.Response, WMATAError>) {","    switch response {","    case let .success(nextBuses):","        print(nextBuses)","    case let .failure(error):","        print(error)","    }","}"]},{"type":"aside","style":"tip","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Your "},{"type":"codeVoice","code":"received(_:)"},{"type":"text","text":" function will receive both successful calls to the API and errors, so be sure to handle both."}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now we’ll create our "},{"type":"codeVoice","code":"CustomEndpointDelegate"},{"type":"text","text":" instance and our "},{"type":"codeVoice","code":"Endpoint"},{"type":"text","text":"."}]},{"type":"codeListing","syntax":"swift","code":["let delegate = CustomEndpointDelegate()","","let endpoint = Bus.NextBuses(","    key: YOUR_API_KEY,","    stop: \"1001195\",","    delegate: delegate",")"]},{"type":"aside","style":"tip","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Be sure to store your delegate in a way that your application maintains a reference to it. Endpoints only maintain weak references to delegates, so if you do not store your delegate on "},{"type":"codeVoice","code":"self"},{"type":"text","text":" or maintain a reference in some way, your delegate will be deallocated."}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Finally, we can make our request. In practice this would happen when your application or extension is in the background."}]},{"type":"codeListing","syntax":"swift","code":["endpoint.backgroundRequest()"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"When your application receives a response from the API, "},{"type":"codeVoice","code":"received(_:)"},{"type":"text","text":" will be called on your delegate."}]},{"anchor":"Application-Extensions","level":2,"type":"heading","text":"Application Extensions"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In order to make background requests within an application extension, you must supply a "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/1409450-sharedcontaineridentifier"},{"type":"text","text":" to your delegate. This is done with "},{"type":"reference","isActive":true,"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/EndpointDelegate\/sharedContainerIdentifier"},{"type":"text","text":". Use the convenience initializer:"}]},{"type":"codeListing","syntax":"swift","code":["CustomEndpointDelegate(","    sharedContainerIdentifier:  \"com.mycompany.myapp.backgroundsession\"",")"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"or set the identifier in your own code:"}]},{"type":"codeListing","syntax":"swift","code":["class CustomEndpointDelegate: JSONEndpointDelegate<Bus.NextBuses> {","    ","    override init() {","        super.init()","        ","        sharedContainerIdentifier = \"com.mycompany.myapp.backgroundsession\"","    }","    ","    ...","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Also see Apple’s "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/url_loading_system\/downloading_files_in_the_background"},{"type":"text","text":"."}]}]}],"schemaVersion":{"major":0,"minor":2,"patch":0},"sections":[],"variants":[{"paths":["\/documentation\/wmata\/backgroundrequests"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/WMATA\/documentation\/WMATA\/BackgroundRequests","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"Calling WMATA APIs while your application is in the background."}],"kind":"article","metadata":{"roleHeading":"Article","title":"Background Requests","role":"article","modules":[{"name":"WMATA"}]},"hierarchy":{"paths":[["doc:\/\/WMATA\/documentation\/WMATA"],["doc:\/\/WMATA\/documentation\/WMATA","doc:\/\/WMATA\/documentation\/WMATA\/Endpoints"]]},"seeAlsoSections":[{"title":"Background Requests","identifiers":["doc:\/\/WMATA\/documentation\/WMATA\/JSONEndpointDelegate","doc:\/\/WMATA\/documentation\/WMATA\/GTFSEndpointDelegate","doc:\/\/WMATA\/documentation\/WMATA\/EndpointDelegate"],"generated":true}],"references":{"doc://WMATA/documentation/WMATA/Stop":{"role":"symbol","title":"Stop","fragments":[{"kind":"keyword","text":"typealias"},{"kind":"text","text":" "},{"kind":"identifier","text":"Stop"}],"abstract":[{"type":"text","text":"A Metrobus stop"},{"type":"text","text":" "},{"type":"image","identifier":"metrobus-stop"}],"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/Stop","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"Stop"}],"url":"\/documentation\/wmata\/stop"},"doc://WMATA/documentation/WMATA/Endpoints":{"role":"collectionGroup","title":"Endpoints","abstract":[{"type":"text","text":"Understanding endpoints and how to make requests the way you need."}],"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/Endpoints","kind":"article","type":"topic","url":"\/documentation\/wmata\/endpoints"},"doc://WMATA/documentation/WMATA/Bus/NextBuses":{"role":"symbol","title":"Bus.NextBuses","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"NextBuses"}],"abstract":[{"type":"text","text":"Next bus arrival times at a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/Stop"}],"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/Bus\/NextBuses","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"NextBuses"}],"url":"\/documentation\/wmata\/bus\/nextbuses"},"doc://WMATA/documentation/WMATA/EndpointDelegate/received(_:)":{"role":"symbol","title":"received(_:)","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"received"},{"kind":"text","text":"("},{"kind":"typeIdentifier","text":"Result","preciseIdentifier":"s:s6ResultO"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"Parent"},{"kind":"text","text":"."},{"kind":"typeIdentifier","text":"Response"},{"kind":"text","text":", "},{"kind":"typeIdentifier","text":"WMATAError","preciseIdentifier":"s:5WMATA10WMATAErrorO"},{"kind":"text","text":">)"}],"abstract":[{"type":"text","text":"Handle a response from a background request. Override this in your own delegate."}],"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/EndpointDelegate\/received(_:)","kind":"symbol","type":"topic","url":"\/documentation\/wmata\/endpointdelegate\/received(_:)"},"doc://WMATA/documentation/WMATA":{"role":"collection","title":"WMATA","abstract":[{"type":"text","text":"WMATA is an interface to the Washington Metropolitan Area Transit Authority API."}],"identifier":"doc:\/\/WMATA\/documentation\/WMATA","kind":"symbol","type":"topic","url":"\/documentation\/wmata"},"doc://WMATA/documentation/WMATA/Endpoint":{"role":"symbol","title":"Endpoint","fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"kind":"identifier","text":"Endpoint"}],"abstract":[{"type":"text","text":"Protocol defining a WMATA API endpoint."}],"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/Endpoint","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"Endpoint"}],"url":"\/documentation\/wmata\/endpoint"},"doc://WMATA/documentation/WMATA/JSONEndpointDelegate":{"role":"symbol","title":"JSONEndpointDelegate","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"JSONEndpointDelegate"}],"abstract":[{"type":"text","text":"A delegate for Standard API endpoints."}],"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/JSONEndpointDelegate","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"JSONEndpointDelegate"}],"url":"\/documentation\/wmata\/jsonendpointdelegate"},"doc://WMATA/documentation/WMATA/EndpointDelegate/sharedContainerIdentifier":{"role":"symbol","title":"sharedContainerIdentifier","fragments":[{"kind":"keyword","text":"var"},{"kind":"text","text":" "},{"kind":"identifier","text":"sharedContainerIdentifier"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"String","preciseIdentifier":"s:SS"},{"kind":"text","text":"?"}],"abstract":[{"type":"text","text":"An indentifier used when running in an app extension."}],"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/EndpointDelegate\/sharedContainerIdentifier","kind":"symbol","type":"topic","url":"\/documentation\/wmata\/endpointdelegate\/sharedcontaineridentifier"},"doc://WMATA/documentation/WMATA/EndpointDelegate":{"role":"symbol","title":"EndpointDelegate","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"EndpointDelegate"}],"abstract":[{"type":"text","text":"Base delegate for receiving background responses from an "},{"type":"reference","isActive":true,"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/Endpoint"},{"type":"text","text":"."}],"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/EndpointDelegate","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"EndpointDelegate"}],"url":"\/documentation\/wmata\/endpointdelegate"},"https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1409450-sharedcontaineridentifier":{"title":"shared container identifier","titleInlineContent":[{"type":"text","text":"shared container identifier"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/1409450-sharedcontaineridentifier","url":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/1409450-sharedcontaineridentifier"},"https://developer.apple.com/documentation/foundation/url_loading_system/downloading_files_in_the_background":{"title":"Downloading Files in the Background","titleInlineContent":[{"type":"text","text":"Downloading Files in the Background"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/url_loading_system\/downloading_files_in_the_background","url":"https:\/\/developer.apple.com\/documentation\/foundation\/url_loading_system\/downloading_files_in_the_background"},"doc://WMATA/documentation/WMATA/GTFSEndpointDelegate":{"role":"symbol","title":"GTFSEndpointDelegate","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"GTFSEndpointDelegate"}],"abstract":[{"type":"text","text":"A delegate for GTFS API endpoints."}],"identifier":"doc:\/\/WMATA\/documentation\/WMATA\/GTFSEndpointDelegate","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"GTFSEndpointDelegate"}],"url":"\/documentation\/wmata\/gtfsendpointdelegate"}}}